<!DOCTYPE html><html lang="null"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.4"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.4"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><title>直白的话告诉你在 javascript 中如何用 jsonp 实现跨域请求 | 多喝热水</title></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">直白的话告诉你在 javascript 中如何用 jsonp 实现跨域请求</h1><a id="logo" href="/.">多喝热水</a><p class="description">十年磨一剑</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 主页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Suche"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">直白的话告诉你在 javascript 中如何用 jsonp 实现跨域请求</h1><div class="post-meta"><a href="/2019/07/09/my-first-blog/#comments" class="comment-count"></a><p><span class="date">Jul 09, 2019</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>Schlägt</i></i></span></p></div><div class="post-content"><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><ul>
<li>这边文档希望通过自己对jsonp的理解，能够采用最简单、最直白的语言告诉大家jsonp是干嘛的！当然，其间难免有纰漏之处，希指正出来！<h3 id="jsonp能解决的问题"><a href="#jsonp能解决的问题" class="headerlink" title="jsonp能解决的问题"></a>jsonp能解决的问题</h3></li>
<li>首先我们需要jsonp是干嘛的，它是一种解决浏览器跨域问题的方案，说道这里什么是浏览器跨域呢！说白了，就是浏览器内部有一种机制为了保证每个站点之间的请求达到安全、独立，相互交互不乱套等，浏览器阻止了不同源站点之间的请求。如果不采用跨域的话，浏览器将会报错的。</li>
</ul>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;Zh-cn&quot;&gt;
&lt;head&gt;
    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot;/&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge,Chrome=1.0&quot;/&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1.0,user-scalable=no&quot;/&gt;
    &lt;meta name=&quot;renderer&quot; content=&quot;webkit&quot;/&gt;
    &lt;meta name=&quot;Keywords&quot; content=&quot;&quot;/&gt;
    &lt;meta name=&quot;description&quot; content=&quot;&quot;/&gt;
    &lt;title&gt;demo&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;script type=&quot;text/javascript&quot;&gt;
    (function(){
        var xhr = new XMLHttpRequest();
        xhr.open(&apos;GET&apos;,&apos;http://localhost/demo/demo1.php&apos;,true);
        xhr.send();
        xhr.onreadystatechange = function(){
            if(xhr.status == 200 &amp;&amp; xhr.readyState == 4){
                console.log(xhr.responseText);
            }else{
                console.log(&apos;什么都没有&apos;);
            };
        };
        xhr.onerror = function(){
            console.log(&apos;请求出错了！&apos;);
        };
    })();
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p>我们通过上面的页面在请求资源时可以看到下面请求跨域错误提示：<br><img src="https://user-gold-cdn.xitu.io/2017/2/4/f8918f4dabadca306b34ae5ab760f216.png?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt></p>
<h3 id="怎样理解跨域，以及它跟浏览器的关系呢！"><a href="#怎样理解跨域，以及它跟浏览器的关系呢！" class="headerlink" title="怎样理解跨域，以及它跟浏览器的关系呢！"></a>怎样理解跨域，以及它跟浏览器的关系呢！</h3><ul>
<li>首先我们不想把概念说的神乎其神，但是大家要理解下面说的话，可以先看下《http报文权威指南》了解下相关概念！这里指出一下，如果只是从http请求的方面来说，上面的页面请求是没有什么问题的，而且也不会报错，因为http本身是无状态的，它也不知道请求的是谁，被请求的是谁，它只知道客户端有请求，服务器把客户端需要的东西返回就好了！<strong>上面的页面之所以会报错，是由于浏览器自己带有了一种叫做同源策略的安全机制产生的！</strong></li>
<li>什么是同源策略，相关概念可以自行google或百度，说白了就是一种机制促使浏览器限制不同源之间的请求。这里说一下什么样的请求是不同源的，看下面的表格：</li>
</ul>
<p>| <a href="http://www.demo.com" target="_blank" rel="noopener">www.demo.com</a>     | <a href="http://www.demo.com" target="_blank" rel="noopener">www.demo.com</a>       |  这是不同源的，因为协议不同<br>| <a href="http://www.demo1.com" target="_blank" rel="noopener">www.demo1.com</a>    | <a href="http://www.demo2.com" target="_blank" rel="noopener">www.demo2.com</a>      |  这是不同源的，因为主机不同<br>| <a href="http://www.demo.com:80" target="_blank" rel="noopener">www.demo.com:80</a>  | <a href="http://www.demo.com:8080" target="_blank" rel="noopener">www.demo.com:8080</a>  |  这是不同源的，因为协议不同   </p>
<h3 id="怎么解决跨域请求问题呢！"><a href="#怎么解决跨域请求问题呢！" class="headerlink" title="怎么解决跨域请求问题呢！"></a>怎么解决跨域请求问题呢！</h3><ul>
<li>常见的和自己熟悉有几种方案，如：1、用cros；2、用代理；3、使用jsonp。这里只对jsonp介绍，其他的方案可以自行查看相关文档。</li>
</ul>
<h3 id="jsonp的原理"><a href="#jsonp的原理" class="headerlink" title="jsonp的原理"></a>jsonp的原理</h3><ul>
<li>jsonp原理其实很简单，首先我们先回归一个现实：我们发现，当我们在html插入img、a、script标签的时候，它们是没有同源限制的。所以jsonp的原理就是利用img、script等标签插入一个请求地址，让不同源的请求远离浏览器的同源策略限制。</li>
</ul>
<h3 id="实（示）例"><a href="#实（示）例" class="headerlink" title="实（示）例"></a>实（示）例</h3><pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;Zh-cn&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;/&gt;
    &lt;title&gt;demo&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;script type=&quot;text/javascript&quot; src=&quot;http://localhost/demo/demo1.php&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
后台demo1.php代码如下:

&lt;?php
    echo &quot;console.log(&apos;欢迎访问demo1.php页面&apos;)&quot;;
?&gt;</code></pre><p>控制台打印结果截图如下：</p>
<p><img src="%EF%BC%81%5B%5D(https://user-gold-cdn.xitu.io/2017/2/4/4eca1f4e72ad115052a1f9d020d0a61b.png?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt></p>
<h3 id="怎么实现精确回调呢！"><a href="#怎么实现精确回调呢！" class="headerlink" title="怎么实现精确回调呢！"></a>怎么实现精确回调呢！</h3><ul>
<li>有时候我们并不是只是见到的得到后台数据就好了，还要到前台进行一些处理，那怎么做呢！恩，没错就是使用回调，首先说一下思路：1、首先在页面中定义好回调函数；2、然后在页面通过插入相关标签待query参数的形式实现jsonp请求传递回调函数名字；3、后台得到回调函数名字，并将需要处理的数据传递给回调函数，最后向前台返回回调函数的“调用”，最后一步切记是传回回调函数的调用。示例如下：</li>
</ul>
<p><strong>前台代码</strong></p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;Zh-cn&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;/&gt;
    &lt;title&gt;demo&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
    //第一步，现在前台定义回调函数
    function addNum(num1,num2){
        var sum = num1 + num2;
        console.log(&quot;两数相加的结果是&quot;+sum);
        return sum;
    };

    //第二步，插入script标签并通过传入query参数的形式传递回调函数的名字给后台
    (function(){
        var _script = document.createElement(&apos;script&apos;);
        _script.type = &apos;text/javascript&apos;;
        _script.src = &apos;http://localhost/demo/demo2.php?callback=addNum&apos;;
        document.body.appendChild(_script);
    })();
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p><strong>后台demo2.php代码如下：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">       <span class="comment">/*第三步，获取前台传过来的回调函数的名字*/</span></span></span><br><span class="line"><span class="php">       $fontEndCallback = $_GET[<span class="string">'callback'</span>];<span class="comment">//addNum;</span></span></span><br><span class="line">       /*这里我们先模拟两个数据$num1,$num2，</span><br><span class="line">         实际生产环境中可能就是查询数据库等操作获取数据</span><br><span class="line"><span class="php">       */</span></span><br><span class="line"><span class="php">       $num1 = <span class="number">15</span>;</span></span><br><span class="line"><span class="php">       $num2 = <span class="number">30</span>;</span></span><br><span class="line"><span class="php">       <span class="comment">/*最后切记是返回回调函数的调用，一定记得是调用*/</span></span></span><br><span class="line"><span class="php">       <span class="keyword">echo</span> $fontEndCallback.<span class="string">"($num1,$num2)"</span>;<span class="comment">//这里的‘.’相当于js里面的字符串连接操作，等同+</span></span></span><br><span class="line"><span class="php">   <span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><strong>控制台结果截图如下：</strong><br><img src="https://user-gold-cdn.xitu.io/2017/2/4/248801d37f0429069c931288c5c4714e.png?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt></p>
<p>只要弄懂这三步你就会对jsonp心领神会了！</p>
<h3 id="jsonp跟ajax的区别、jsonp和json的区别"><a href="#jsonp跟ajax的区别、jsonp和json的区别" class="headerlink" title="jsonp跟ajax的区别、jsonp和json的区别"></a>jsonp跟ajax的区别、jsonp和json的区别</h3><ul>
<li>首先严格来说，jsonp和ajax是没有关系，唯一的相同点可能就是都是向后台发请求！jsonp和json也是没有关系的，虽然看上去名字很像，但是jsonp描述的是一种请求数据的跨域方式，而json是一种数据格式！</li>
</ul>
<script src="https://utteranc.es/client.js" repo="nusr/blog" issue-term="pathname" theme="github-light" crossorigin="anonymous" async>
</script>

</div><div class="post-copyright"><blockquote><p>Ursprünglicher Autor: 陈坤</p><p>Ursprünglicher Link: <a href="http://yoursite.com/2019/07/09/my-first-blog/">http://yoursite.com/2019/07/09/my-first-blog/</a></p><p>Copyright-Erklärung: Bitte geben Sie die Quelle des Nachdrucks an.</p></blockquote></div><div class="tags"></div><div class="post-share"><div class="social-share"><span>Aktie:</span></div></div><div class="post-nav"><a href="/2019/07/22/hello-world/" class="pre">Hello World</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">Inhalte</i></div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#前言"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jsonp能解决的问题"><span class="toc-text">jsonp能解决的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#怎样理解跨域，以及它跟浏览器的关系呢！"><span class="toc-text">怎样理解跨域，以及它跟浏览器的关系呢！</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#怎么解决跨域请求问题呢！"><span class="toc-text">怎么解决跨域请求问题呢！</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jsonp的原理"><span class="toc-text">jsonp的原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实（示）例"><span class="toc-text">实（示）例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#怎么实现精确回调呢！"><span class="toc-text">怎么实现精确回调呢！</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jsonp跟ajax的区别、jsonp和json的区别"><span class="toc-text">jsonp跟ajax的区别、jsonp和json的区别</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/07/22/hello-world/">Hello World</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/07/09/my-first-blog/">直白的话告诉你在 javascript 中如何用 jsonp 实现跨域请求</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> Tags</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> Archiv</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> Blogroll</i></div><ul></ul><a href="https://achuan.io/" title="阿川的个人博客" target="_blank">阿川的个人博客</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Sitemap</a> |  <a href="/atom.xml">Abonnieren Sie diese Site</a> |  <a href="/about/">Kontaktieren Sie den Blogger</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">陈坤.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?b7f25be6a797902749358554e4f63006";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/search.json.js?v=2.0.4"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.4" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/miku.model.json"},"display":{"position":"right","width":250,"height":600},"mobile":{"show":true}});</script></body></html>